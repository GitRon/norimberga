{% load crispy_forms_tags tailwind_filters %}
<div id="form-container" class="p-6">
    <h1 class="text-xl font-bold mb-4">Build something: {{ object.terrain }} ({{ object }})</h1>
    <form method="POST" action="{% url "city:tile-build" object.id %}">
        {% comment %}Only show building select if not a ruin{% endcomment %}
        {% if not object.building or object.building.building_type.type != 2 %}
            {% crispy form %}
        {% endif %}
        {% comment %}Show warning only when there's no building and no available buildings{% endcomment %}
        {% if not object.building and not form.fields.building.queryset %}
            <div class="alert alert-warning mb-4" role="alert">
                <div>
                    <p class="font-bold">No buildings available</p>
                    <p>This tile doesn't support any buildings, or all available buildings have been built.</p>
                </div>
            </div>
        {% endif %}
        <div class="flex gap-2">
            {% if form.fields.building.queryset %}
                <button class="btn btn-success"
                        hx-post="{% url "city:tile-build" object.id %}"
                        hx-target="#form-container"
                        hx-swap="outerHTML">
                    Commence changes!
                </button>
            {% endif %}
            {% if object.building %}
                {% comment %}Allow demolishing non-unique buildings or ruins (ruins have type=RUINS){% endcomment %}
                {% if not object.building.building_type.is_unique or object.building.building_type.type == 2 %}
                    <button class="btn btn-error text-white"
                            hx-post="{% url "city:tile-demolish" object.id %}"
                            hx-target="#form-container"
                            hx-swap="outerHTML"
                            hx-confirm="Are you sure you want to demolish {{ object.building.name }}?{% if object.building.demolition_costs > 0 %} This will cost {{ object.building.demolition_costs }} coins.{% endif %}">
                        Demolish Building{% if object.building.demolition_costs > 0 %} ({{ object.building.demolition_costs }} coins){% endif %}
                    </button>
                {% endif %}
            {% endif %}
        </div>
    </form>
</div>
