{% load crispy_forms_tags tailwind_filters %}
<div id="form-container" class="p-6">
    <h1 class="text-xl font-bold mb-4">Build something: {{ object.terrain }} ({{ object }})</h1>
    <form method="POST" action="{% url "city:tile-build" object.id %}">
        {% comment %}Only show building select if not a ruin{% endcomment %}
        {% if not object.building or object.building.building_type.type != 2 %}
            {% crispy form %}
        {% endif %}
        {% comment %}Show warning only when there's no building and no available buildings{% endcomment %}
        {% if not object.building and not form.fields.building.queryset %}
            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4" role="alert">
                <p class="font-bold">No buildings available</p>
                <p>This tile doesn't support any buildings, or all available buildings have been built.</p>
            </div>
        {% endif %}
        <div class="flex gap-2">
            {% if form.fields.building.queryset %}
                <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
                        hx-post="{% url "city:tile-build" object.id %}"
                        hx-target="#form-container"
                        hx-swap="outerHTML"
                        onclick="setTimeout(() => { document.getElementById('build-modal').classList.add('hidden'); htmx.trigger('body', 'refreshMap'); }, 100)">
                    Commence changes!
                </button>
            {% endif %}
            {% if object.building %}
                {% comment %}Allow demolishing non-unique buildings or ruins (ruins have type=RUINS){% endcomment %}
                {% if not object.building.building_type.is_unique or object.building.building_type.type == 2 %}
                    <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
                            hx-post="{% url "city:tile-demolish" object.id %}"
                            hx-target="#form-container"
                            hx-swap="outerHTML"
                            hx-confirm="Are you sure you want to demolish {{ object.building.name }}?{% if object.building.demolition_costs > 0 %} This will cost {{ object.building.demolition_costs }} coins.{% endif %}"
                            onclick="setTimeout(() => { document.getElementById('build-modal').classList.add('hidden'); htmx.trigger('body', 'refreshMap'); }, 100)">
                        Demolish Building{% if object.building.demolition_costs > 0 %} ({{ object.building.demolition_costs }} coins){% endif %}
                    </button>
                {% endif %}
            {% endif %}
        </div>
    </form>
</div>
